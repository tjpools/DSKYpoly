# === Makefile for DSKYpoly-5 (Quintic Solver) ===
# Beyond Radical Solvability: Numerical Methods for General Quintics

# Compiler and Assembler
CC      = gcc
AS      = nasm

# Flags
CFLAGS  = -Wall -g -O2
ASFLAGS = -f elf64
LDFLAGS = -no-pie -lm

# Folder Structure
BUILD   = build
SRC     = src
INCLUDE = include
QUARTIC = ../quartic

# Source files
C_SRC   = $(SRC)/main.c
ASM_SRC_REF = $(SRC)/solve_poly_5_reference.asm
ASM_SRC_SPECIAL = $(SRC)/solve_poly_5_special.asm
ASM_SRC_NUMERICAL = $(SRC)/solve_poly_5_numerical.asm
ASM_SRC_HYBRID = $(SRC)/solve_poly_5_hybrid.asm

# Object and Binary output
OBJ     = $(BUILD)/main.o $(BUILD)/solve_poly_5_reference.o $(BUILD)/solve_poly_5_special.o
EXE     = $(BUILD)/dskypoly5

# Targets we can invoke from terminal
.PHONY: all clean run test log_structure debug check version doctor quintic_info galois_theory abel_ruffini

# === Core Build Rules ===
all: $(EXE) log_structure debug check

# === Ensure build directory exists ===
build:
	@mkdir -p $(BUILD)

# === Linking: final binary from object files ===
$(EXE): $(OBJ) | build
	@echo "üñáÔ∏è Linking quintic solver..."
	$(CC) $(OBJ) -o $@ $(LDFLAGS)

# === Compile C source ===
$(BUILD)/main.o: $(C_SRC) | build
	@echo "üìê Compiling C interface..."
	$(CC) $(CFLAGS) -c $< -o $@

# === Assemble Reference Architecture ===
$(BUILD)/solve_poly_5_reference.o: $(ASM_SRC_REF) | build
	@echo "üîß Assembling quintic solver (reference architecture)..."
	$(AS) $(ASFLAGS) $< -o $@

# === Future assembly targets ===
$(BUILD)/solve_poly_5_special.o: $(ASM_SRC_SPECIAL) | build
	@echo "üîß Assembling solvable quintic cases..."
	$(AS) $(ASFLAGS) $< -o $@

$(BUILD)/solve_poly_5_numerical.o: $(ASM_SRC_NUMERICAL) | build
	@echo "üîß Assembling numerical methods..."
	$(AS) $(ASFLAGS) $< -o $@

$(BUILD)/solve_poly_5_hybrid.o: $(ASM_SRC_HYBRID) | build
	@echo "üîß Assembling hybrid solver..."
	$(AS) $(ASFLAGS) $< -o $@

# === Run the program ===
run: $(EXE)
	@echo "üöÄ Running DSKYpoly-5 (Quintic Solver)..."
	./$(EXE)

# === Clean build artifacts ===
clean:
	@echo "‚ôªÔ∏è  Cleaning quintic build files..."
	rm -rf $(BUILD)/*.o $(EXE) DSKYpoly5.log

# === Log project structure ===
log_structure:
	@echo "================================================================"
	@echo "üìÅ Logging quintic project structure..."
	@echo "=== Quintic Project Structure Snapshot ===" > DSKYpoly5.log
	@date >> DSKYpoly5.log
	@tree -L 3 . >> DSKYpoly5.log
	@echo "" >> DSKYpoly5.log

# === Debug info ===
debug:
	@echo "================================================================"
	@echo "üß† Quintic Debug Info:"
	@echo " Source Directory:     $(SRC)"
	@echo " Build Directory:      $(BUILD)"
	@echo " C Source File:        $(C_SRC)"
	@echo " ASM Reference:        $(ASM_SRC_REF)"
	@echo " Object Files:         $(OBJ)"
	@echo " Executable Target:    $(EXE)"
	@echo " Compiler:             $(CC)"
	@echo " Assembler:            $(AS)"
	@echo " Quartic Dependency:   $(QUARTIC)"
	@echo "================================================================"

# === Check project structure ===
check:
	@echo "üîç Checking Quintic Project Structure..."
	@test -f $(C_SRC) && echo "‚úÖ Found: $(C_SRC)" || echo "‚ùå Missing: $(C_SRC)"
	@test -f $(ASM_SRC_REF) && echo "‚úÖ Found: $(ASM_SRC_REF)" || echo "‚è≥ Pending: $(ASM_SRC_REF)"
	@test -f Makefile && echo "‚úÖ Found: Makefile" || echo "‚ùå Missing: Makefile"
	@test -d $(BUILD) && echo "‚úÖ Found: $(BUILD)/" || echo "‚è≥ Will create: $(BUILD)/"
	@test -d $(QUARTIC) && echo "‚úÖ Found: $(QUARTIC)/ (for reference patterns)" || echo "‚ö†Ô∏è  Missing: $(QUARTIC)/"
	@echo "üìù Logging structure to DSKYpoly5.log..."

# === Quintic mathematical info ===
quintic_info:
	@echo "================================================================"
	@echo "üéì Quintic Mathematical Context:"
	@echo "================================================================"
	@echo "üìê Abel-Ruffini Theorem (1824-1826):"
	@echo "   ‚Ä¢ No general quintic solvable by radicals"
	@echo "   ‚Ä¢ Proved by Niels Henrik Abel and Paolo Ruffini"
	@echo ""
	@echo "üßÆ Galois Theory Insights:"
	@echo "   ‚Ä¢ Symmetric group S‚ÇÖ has 120 permutations"
	@echo "   ‚Ä¢ Alternating group A‚ÇÖ ‚äÇ S‚ÇÖ (60 even permutations)"
	@echo "   ‚Ä¢ A‚ÇÖ is simple and non-solvable"
	@echo "   ‚Ä¢ Only solvable subgroups allow radical solutions"
	@echo ""
	@echo "‚ö° Solvable Special Cases:"
	@echo "   ‚Ä¢ Monomial: x‚Åµ - a = 0"
	@echo "   ‚Ä¢ Certain binomial forms"
	@echo "   ‚Ä¢ Factorizable polynomials"
	@echo ""
	@echo "üî¨ Numerical Methods Required:"
	@echo "   ‚Ä¢ Newton-Raphson iteration"
	@echo "   ‚Ä¢ Durand-Kerner method"
	@echo "   ‚Ä¢ Complex root approximation"
	@echo "================================================================"

# === Galois theory educational target ===
galois_theory:
	@echo "üèõÔ∏è Galois Theory and Quintic Solvability:"
	@echo "================================================================"
	@echo "Group S‚ÇÖ (Symmetric group on 5 elements):"
	@echo "  ‚Ä¢ Order: 120 elements"
	@echo "  ‚Ä¢ Generators: (1 2) and (1 2 3 4 5)"
	@echo "  ‚Ä¢ Contains A‚ÇÖ as normal subgroup"
	@echo ""
	@echo "Group A‚ÇÖ (Alternating group on 5 elements):"
	@echo "  ‚Ä¢ Order: 60 elements (even permutations)"
	@echo "  ‚Ä¢ Simple group (no non-trivial normal subgroups)"
	@echo "  ‚Ä¢ NOT solvable ‚Üí quintic not solvable by radicals"
	@echo ""
	@echo "Solvable quintics correspond to polynomials whose"
	@echo "Galois group is a solvable subgroup of S‚ÇÖ, avoiding A‚ÇÖ."
	@echo "================================================================"

# === Abel-Ruffini theorem context ===
abel_ruffini:
	@echo "üìö Abel-Ruffini Theorem Historical Context:"
	@echo "================================================================"
	@echo "Paolo Ruffini (1765-1822):"
	@echo "  ‚Ä¢ 1799: First proof attempt (incomplete)"
	@echo "  ‚Ä¢ Showed general quintic unsolvable by radicals"
	@echo ""
	@echo "Niels Henrik Abel (1802-1829):"
	@echo "  ‚Ä¢ 1824: Complete rigorous proof"
	@echo "  ‚Ä¢ Established fundamental limitations of algebra"
	@echo "  ‚Ä¢ Opened path to Galois theory"
	@echo ""
	@echo "Impact:"
	@echo "  ‚Ä¢ End of 300-year quest for quintic formula"
	@echo "  ‚Ä¢ Birth of abstract algebra"
	@echo "  ‚Ä¢ Foundation for modern group theory"
	@echo "================================================================"

# === Version information ===
version:
	@echo "DSKYpoly-5 Quintic Solver"
	@echo "Mathematical Foundation: Abel-Ruffini Theorem + Galois Theory"
	@echo "Implementation: x86-64 Assembly + Numerical Methods"
	@echo "Status: Reference Architecture Development"
